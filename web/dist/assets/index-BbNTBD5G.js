import{j as t,I as Oa,c as z,d as Qa,e as Et,f as Va,g as Ka,h as za,i as Wa,E as ge,D as Ga,B as Me,k as Za,l as wt,M as Ya,F as te,C as ae,A as Ja,S as St,T as _t,m as A,n as Xa,o as Bt,p as Nt,q as Mt,r as es,s as ts,t as as,P as ss}from"./semi-ui-ClUhRvP3.js";import{r,u as os,R as ls}from"./react-core-DtMAePju.js";import{l as At,V as se,a as $}from"./visactor-C6yu58Ir.js";import{m as Ae}from"./tools-CmMbhh-g.js";import{I as be,a as Ce}from"./IllustrationConstruction-h2fiJesH.js";import{aL as rs,aM as ns,aN as is,aO as cs,aP as us,aQ as fe,aR as E,aS as D,aT as I,aU as ds,aV as ms,aW as $e,aX as ps,aY as hs,A as W,s as G,aZ as Ie,a_ as gs,a$ as bs,b0 as Cs,b1 as fs,b2 as xs,b3 as ys}from"./index-D8gcSXCW.js";import{u as vs}from"./i18n-CtMfBwdO.js";import"./react-components-XvIrFW7f.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],Ds=rs("wallet",js),$t="Inter,-apple-system,BlinkMacSystemFont,Segoe UI,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Helvetica Neue,Helvetica,Arial,sans-serif",Le="theme-mode",It=(u,c,p)=>{const n=u&&getComputedStyle(document.body).getPropertyValue(u)||c;return n&&!isNaN(n[0])?`rgba(${n})`:n},ks=(u,c,p)=>{new MutationObserver(n=>{n.forEach(h=>{h.attributeName===c&&p(h)})}).observe(u,{attributes:!0})},Fs=(u,c,p,n)=>c.map((h,o)=>{const{scheme:k}=p[o];return Object.assign(Object.assign({},h),{scheme:h.scheme.map((R,H)=>It(typeof R=="object"?R[u]:R,k==null?void 0:k[H]))})}),Ts=(u,c,p,n)=>{const h={};return Object.keys(c).forEach(o=>{const k=typeof c[o]=="object"?c[o][u]:c[o];h[o]=It(k,p[o])}),h},Rt=()=>document.body.hasAttribute(Le)&&document.body.getAttribute(Le)==="dark"?"dark":"light",Es=u=>`semiDesign${u[0].toUpperCase()}${u.slice(1)}`,ws=u=>{new MutationObserver(c=>{c.forEach(p=>{var n;if(p.addedNodes.length===1){const h=p.addedNodes[0];h.tagName==="LINK"&&((n=h.getAttribute)===null||n===void 0?void 0:n.call(h,"semi-theme-switcher"))==="true"&&u(p,h)}})}).observe(document.body,{childList:!0})},Ss={default:{dataScheme:At.colorScheme.default.dataScheme,palette:{backgroundColor:"#16161a",borderColor:"rgba(255,255,255,0.08)",shadowColor:"rgba(0,0,0,0.25)",hoverBackgroundColor:"rgba(255,255,255,0.12)",sliderRailColor:"rgba(255,255,255,0.12)",sliderHandleColor:"#e4e7f5",sliderTrackColor:"rgba(84,169,255,1)",popupBackgroundColor:"#43444a",primaryFontColor:"rgba(249,249,249,1)",secondaryFontColor:"rgba(249,249,249,0.8)",tertiaryFontColor:"rgba(249,249,249,0.6)",axisLabelFontColor:"rgba(249,249,249,0.6)",disableFontColor:"rgba(249,249,249,0.35)",axisMarkerFontColor:"#16161a",axisGridColor:"rgba(255,255,255,0.08)",axisDomainColor:"rgba(255,255,255,0.08)",dataZoomHandleStrokeColor:"rgba(46,50,56,0.13)",dataZoomChartColor:"rgba(255,255,255,0.16)",playerControllerColor:"rgba(84,169,255,1)",axisMarkerBackgroundColor:"rgba(249,249,249,1)",markLabelBackgroundColor:"rgba(255,255,255,0.08)",markLineStrokeColor:"rgba(249,249,249,0.8)",dangerColor:"rgba(252,114,90,1)",warningColor:"rgba(255,174,67,1)",successColor:"rgba(93,194,100,1)",infoColor:"rgba(84,169,255,1)"}}},_s={name:"semiDesignDark",description:"Semi Design - dark",type:"dark",fontFamily:$t,colorScheme:Ss},Bs={default:{dataScheme:At.colorScheme.default.dataScheme,palette:{backgroundColor:"rgba(255,255,255,1)",borderColor:"rgba(28,31,35,0.08)",shadowColor:"rgba(0,0,0,0.1)",hoverBackgroundColor:"rgba(46,50,56,0.05)",sliderRailColor:"rgba(46,50,56,0.05)",sliderHandleColor:"rgba(255,255,255,1)",sliderTrackColor:"rgba(0,100,250,1)",popupBackgroundColor:"rgba(255,255,255,1)",primaryFontColor:"rgba(28,31,35,1)",secondaryFontColor:"rgba(28,31,35,0.8)",tertiaryFontColor:"rgba(28,31,35,0.62)",axisLabelFontColor:"rgba(28,31,35,0.62)",disableFontColor:"rgba(28,31,35,0.35)",axisMarkerFontColor:"rgba(255,255,255,1)",axisGridColor:"rgba(28,31,35,0.08)",axisDomainColor:"rgba(28,31,35,0.15)",dataZoomHandleStrokeColor:"rgba(46,50,56,0.13)",dataZoomChartColor:"rgba(46,50,56,0.09)",playerControllerColor:"rgba(0,100,250,1)",axisMarkerBackgroundColor:"rgba(28,31,35,1)",markLabelBackgroundColor:"rgba(28,31,35,0.08)",markLineStrokeColor:"rgba(28,31,35,0.8)",dangerColor:"rgba(249,57,32,1)",warningColor:"rgba(252,136,0,1)",successColor:"rgba(59,179,70,1)",infoColor:"rgba(0,100,250,1)"}}},Ns={name:"semiDesignLight",description:"Semi Design - light",type:"light",fontFamily:$t,colorScheme:Bs},Ms={backgroundColor:"--semi-color-bg-0",borderColor:"--semi-color-border",hoverBackgroundColor:"--semi-color-fill-0",sliderRailColor:"--semi-color-fill-0",sliderHandleColor:"--semi-white",sliderTrackColor:"--semi-color-primary",popupBackgroundColor:"--semi-color-bg-3",primaryFontColor:"--semi-color-text-0",secondaryFontColor:"--semi-color-text-1",tertiaryFontColor:"--semi-color-text-2",axisLabelFontColor:"--semi-color-text-0",disableFontColor:"--semi-color-disabled-text",axisMarkerFontColor:"--semi-color-bg-0",axisGridColor:"--semi-color-border",axisDomainColor:{light:"--semi-grey-9",dark:"--semi-color-border"},dataZoomHandleStrokeColor:{light:"--semi-color-fill-2"},dataZoomChartColor:"--semi-color-fill-1",playerControllerColor:"--semi-color-primary",axisMarkerBackgroundColor:"--semi-color-text-0",markLabelBackgroundColor:"--semi-color-border",markLineStrokeColor:"--semi-color-text-1",dangerColor:"--semi-color-danger",warningColor:"--semi-color-warning",successColor:"--semi-color-success",infoColor:"--semi-color-info"},As=[{maxDomainLength:10,scheme:["--semi-color-data-0","--semi-color-data-2","--semi-color-data-4","--semi-color-data-6","--semi-color-data-8","--semi-color-data-10","--semi-color-data-12","--semi-color-data-14","--semi-color-data-16","--semi-color-data-18"]},{scheme:["--semi-color-data-0","--semi-color-data-1","--semi-color-data-2","--semi-color-data-3","--semi-color-data-4","--semi-color-data-5","--semi-color-data-6","--semi-color-data-7","--semi-color-data-8","--semi-color-data-9","--semi-color-data-10","--semi-color-data-11","--semi-color-data-12","--semi-color-data-13","--semi-color-data-14","--semi-color-data-15","--semi-color-data-16","--semi-color-data-17","--semi-color-data-18","--semi-color-data-19"]}],$s={light:Ns,dark:_s},He=(u,c)=>{const p=$s[u],{dataScheme:n,palette:h}=p.colorScheme.default,o={default:{dataScheme:Fs(u,As,n),palette:Ts(u,Ms,h)}};return Object.assign(Object.assign({},p),{colorScheme:o})},Is=u=>{const{defaultMode:c,isWatchingMode:p=!0,isWatchingThemeSwitch:n=!1}=u??{};Re(!1,c),p&&ks(document.body,Le,()=>Re()),n&&ws(()=>{const h=Rt(),o=JSON.stringify(He(h).colorScheme);let k=0;const R=setInterval(()=>{const H=He(h);(k>50||o!==JSON.stringify(H.colorScheme))&&(Re(!0,h,H),clearInterval(R)),k++},100)})},Re=(u,c,p)=>{c||(c=Rt());const n=Es(c);(u||se.ThemeManager.getCurrentTheme()!==n)&&(u&&se.ThemeManager.removeTheme(n),se.ThemeManager.themeExist(n)||se.ThemeManager.registerTheme(n,p??He(c)),se.ThemeManager.setCurrentTheme(n))},Js=u=>{var ht,gt,bt,Ct,ft,xt,yt,vt,jt,Dt,kt;const[c,p]=r.useContext(ns),[n,h]=r.useContext(is),{t:o}=vs(),k=os(),R=cs(),H=r.useRef(),Pe=r.useRef(!1),qe=r.useRef(null),S={mode:"desktop-browser"},Z={shadows:"always",bordered:!1,headerLine:!0},Lt={className:"w-full mb-2 !rounded-lg",size:"large"},Ue="text-white hover:bg-opacity-80 !rounded-full",xe="flex items-center gap-2",_={width:96,height:96};let Oe=new Date;const f=us();(ht=n==null?void 0:n.status)==null||ht.api_info_enabled;const Qe=((gt=n==null?void 0:n.status)==null?void 0:gt.announcements_enabled)??!0,Ve=((bt=n==null?void 0:n.status)==null?void 0:bt.faq_enabled)??!0,Ke=((Ct=n==null?void 0:n.status)==null?void 0:Ct.uptime_kuma_enabled)??!0,Ht=!1,Pt=Qe||Ve||Ke,ye=r.useCallback(()=>localStorage.getItem("data_export_default_time")||"hour",[]),oe=r.useCallback((e,a=!1)=>{const s={hour:a?3600:60,day:a?86400:1440,week:a?604800:10080};return s[e]||s.hour},[]),qt=r.useCallback(()=>{const e=ye(),a=new Date().getTime()/1e3;switch(e){case"hour":return fe(a-86400);case"week":return fe(a-86400*30);default:return fe(a-86400*7)}},[ye]),P=r.useCallback((e,a,s)=>{e.has(a)||e.set(a,0),e.set(a,e.get(a)+s)},[]),ze=r.useCallback((e,...a)=>{a.forEach(s=>{s.has(e)||s.set(e,0)})},[]),j=r.useCallback((e,a,s,l,i)=>{e(d=>({...d,data:[{id:i,values:a}],title:{...d.title,subtext:s},color:{specified:l}}))},[]),Y=r.useCallback((e,a)=>t.jsxs("div",{className:xe,children:[t.jsx(e,{size:16}),a]}),[]),le=r.useCallback((e,a)=>t.jsx(e,{...Lt,...a}),[]),Ut=r.useMemo(()=>[{label:o("小时"),value:"hour"},{label:o("天"),value:"day"},{label:o("周"),value:"week"}],[o]),[Ot,Qt]=r.useState({username:"",token_name:"",model_name:"",start_timestamp:qt(),end_timestamp:fe(Oe.getTime()/1e3+3600),channel:"",data_export_default_time:""}),[g,Vt]=r.useState(ye()),[ve,We]=r.useState(!1),[Kt,zt]=r.useState(!1),[Rs,Wt]=r.useState([]),[je,Gt]=r.useState(0),[q,Zt]=r.useState(0),[U,Yt]=r.useState(0),[Jt,Xt]=r.useState([{type:"null",value:"0"}]),[ea,ta]=r.useState([]),[Ge,aa]=r.useState({}),[B,sa]=r.useState("1"),[Ls,oa]=r.useState(!1),[la,De]=r.useState(!1),[O,ra]=r.useState({balance:[],usedQuota:[],requestCount:[],times:[],consumeQuota:[],tokens:[],rpm:[],tpm:[]}),[Hs,na]=r.useState([]),[Ps,ia]=r.useState([]),[qs,ca]=r.useState([]),[ua,da]=r.useState({type:"bar",data:[{id:"channelData",values:[]}],xField:"Time",yField:"Count",seriesField:"Channel",legends:{visible:!0,selectMode:"single"},title:{visible:!0,text:o("按渠道调用次数统计"),subtext:""},tooltip:{mark:{content:[{key:e=>e.Channel,value:e=>E(e.Count)}]}},color:{specified:D}}),[ma,pa]=r.useState({type:"bar",data:[{id:"tokenData",values:[]}],xField:"Time",yField:"Count",seriesField:"Token",legends:{visible:!0,selectMode:"single"},title:{visible:!0,text:o("按令牌调用次数统计"),subtext:""},tooltip:{mark:{content:[{key:e=>e.Token,value:e=>E(e.Count)}]}},color:{specified:D}}),[ha,ga]=r.useState({type:"bar",data:[{id:"userData",values:[]}],xField:"Time",yField:"Count",seriesField:"User",legends:{visible:!0,selectMode:"single"},title:{visible:!0,text:o("按用户调用次数统计"),subtext:""},tooltip:{mark:{content:[{key:e=>e.User,value:e=>E(e.Count)}]}},color:{specified:D}}),ke=r.useRef(null),Fe=r.useRef(null),Te=r.useRef(null),re=r.useRef({}),[ba,Ze]=r.useState(!1),[Ca,Ye]=r.useState(!1),[Je,ne]=r.useState(!1),[N,fa]=r.useState([]),[Xe,et]=r.useState(!1),[M,tt]=r.useState(""),{username:Ee,model_name:Us,start_timestamp:x,end_timestamp:y,channel:Os}=Ot,[xa,ya]=r.useState({type:"pie",data:[{id:"id0",values:Jt}],outerRadius:.8,innerRadius:.5,padAngle:.6,valueField:"value",categoryField:"type",pie:{style:{cornerRadius:10},state:{hover:{outerRadius:.85,stroke:"#000",lineWidth:1},selected:{outerRadius:.85,stroke:"#000",lineWidth:1}}},title:{visible:!0,text:o("模型调用次数占比"),subtext:`${o("总计")}：${E(U)}`},legends:{visible:!0,orient:"left"},label:{visible:!0},tooltip:{mark:{content:[{key:e=>e.type,value:e=>E(e.value)}]}},color:{specified:D}}),[va,ja]=r.useState({type:"bar",data:[{id:"barData",values:ea}],xField:"Time",yField:"Usage",seriesField:"Model",stack:!0,legends:{visible:!0,selectMode:"single"},title:{visible:!0,text:o("模型消耗分布"),subtext:`${o("总计")}：${I(je,2)}`},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},tooltip:{mark:{content:[{key:e=>e.Model,value:e=>I(e.rawQuota||0,4)}]},dimension:{content:[{key:e=>e.Model,value:e=>e.rawQuota||0}],updateContent:e=>{e.sort((s,l)=>l.value-s.value);let a=0;for(let s=0;s<e.length;s++){if(e[s].key=="其他")continue;let l=parseFloat(e[s].value);isNaN(l)&&(l=0),e[s].datum&&e[s].datum.TimeSum&&(a=e[s].datum.TimeSum),e[s].value=I(l,4)}return e.unshift({key:o("总计"),value:I(a,4)}),e}}},color:{specified:D}}),[Da,ka]=r.useState({type:"line",data:[{id:"lineData",values:[]}],xField:"Time",yField:"Count",seriesField:"Model",legends:{visible:!0,selectMode:"single"},title:{visible:!0,text:o("模型消耗趋势"),subtext:""},tooltip:{mark:{content:[{key:e=>e.Model,value:e=>E(e.Count)}]}},color:{specified:D}}),[Fa,Ta]=r.useState({type:"bar",data:[{id:"rankData",values:[]}],xField:"Model",yField:"Count",seriesField:"Model",legends:{visible:!0,selectMode:"single"},title:{visible:!0,text:o("模型调用次数排行"),subtext:""},bar:{state:{hover:{stroke:"#000",lineWidth:1}}},tooltip:{mark:{content:[{key:e=>e.Model,value:e=>E(e.Count)}]}},color:{specified:D}}),we=r.useMemo(()=>{const e=(Date.parse(y)-Date.parse(x))/6e4,a=isNaN(U/e)?"0":(U/e).toFixed(3),s=isNaN(q/e)?"0":(q/e).toFixed(3);return{avgRPM:a,avgTPM:s,timeDiff:e}},[U,q,y,x]),Ea=r.useMemo(()=>{var l;const e=new Date().getHours();let a="";e>=5&&e<12?a=o("早上好"):e>=12&&e<14?a=o("中午好"):e>=14&&e<18?a=o("下午好"):a=o("晚上好");const s=((l=c==null?void 0:c.user)==null?void 0:l.username)||"";return`👋${a}，${s}`},[o,(ft=c==null?void 0:c.user)==null?void 0:ft.username]),wa=r.useCallback((e,a)=>({type:"line",data:[{id:"trend",values:e.map((s,l)=>({x:l,y:s}))}],xField:"x",yField:"y",height:40,width:100,axes:[{orient:"bottom",visible:!1},{orient:"left",visible:!1}],padding:0,autoFit:!1,legends:{visible:!1},tooltip:{visible:!1},crosshair:{visible:!1},line:{style:{stroke:a,lineWidth:2}},point:{visible:!1},background:{fill:"transparent"}}),[]),Sa=r.useMemo(()=>{var e,a,s;return[{title:Y(Ds,o("账户数据")),color:"bg-blue-50",bgColor:"#d0effe",items:[{title:o("当前余额"),value:I((e=c==null?void 0:c.user)==null?void 0:e.quota),icon:t.jsx(Oa,{}),avatarColor:"blue",onClick:()=>k("/console/topup"),trendData:[],trendColor:"#3b82f6",trendBgColor:"#d0effe"},{title:o("历史消耗"),value:I((a=c==null?void 0:c.user)==null?void 0:a.used_quota),icon:t.jsx(z,{}),avatarColor:"purple",trendData:[],trendColor:"#8b5cf6",trendBgColor:"#d0effe"}]},{title:Y(ds,o("使用统计")),color:"bg-green-50",bgColor:"#e1f6e5",items:[{title:o("请求次数"),value:(s=c.user)==null?void 0:s.request_count,icon:t.jsx(Qa,{}),avatarColor:"green",trendData:[],trendColor:"#10b981",trendBgColor:"#e1f6e5"},{title:o("统计次数"),value:U,icon:t.jsx(Et,{}),avatarColor:"cyan",trendData:O.times,trendColor:"#06b6d4",trendBgColor:"#e1f6e5"}]},{title:Y(ms,o("资源消耗")),color:"bg-yellow-50",bgColor:"#faf4e6",items:[{title:o("统计额度"),value:I(je),icon:t.jsx(Va,{}),avatarColor:"yellow",trendData:O.consumeQuota,trendColor:"#f59e0b",trendBgColor:"#faf4e6"},{title:o("统计Tokens"),value:isNaN(q)?0:q,icon:t.jsx(Ka,{}),avatarColor:"pink",trendData:O.tokens,trendColor:"#ec4899",trendBgColor:"#faf4e6"}]},{title:Y($e,o("性能指标")),color:"bg-indigo-50",bgColor:"#efddf2",items:[{title:o("平均RPM"),value:we.avgRPM,icon:t.jsx(za,{}),avatarColor:"indigo",trendData:O.rpm,trendColor:"#6366f1",trendBgColor:"#efddf2"},{title:o("平均TPM"),value:we.avgTPM,icon:t.jsx(Wa,{}),avatarColor:"orange",trendData:O.tpm,trendColor:"#f97316",trendBgColor:"#efddf2"}]}]},[Y,o,(xt=c==null?void 0:c.user)==null?void 0:xt.quota,(yt=c==null?void 0:c.user)==null?void 0:yt.used_quota,(vt=c==null?void 0:c.user)==null?void 0:vt.request_count,U,je,q,O,we,k]);r.useCallback(async e=>{await ps(e)&&hs(o("复制成功"))},[o]),r.useCallback(e=>{const s=`https://www.tcptest.cn/http/${encodeURIComponent(e)}`;window.open(s,"_blank","noopener,noreferrer")},[]);const ie=r.useCallback((e,a)=>{if(a==="data_export_default_time"){Vt(e);return}Qt(s=>({...s,[a]:e}))},[]),ce=r.useCallback(async()=>{We(!0);const e=Date.now();try{let a="",s=Date.parse(x)/1e3,l=Date.parse(y)/1e3;f?a=`/api/data/?username=${Ee}&start_timestamp=${s}&end_timestamp=${l}&default_time=${g}`:a=`/api/data/self/?start_timestamp=${s}&end_timestamp=${l}&default_time=${g}`;const i=await W.get(a),{success:d,message:b,data:F}=i.data;d?(Wt(F),F.length===0&&F.push({count:0,model_name:"无数据",quota:0,created_at:Oe.getTime()/1e3}),F.sort((V,v)=>V.created_at-v.created_at),Ia(F)):G(b)}finally{const a=Date.now()-e,s=Math.max(0,500-a);setTimeout(()=>{We(!1)},s)}},[x,y,Ee,g,f]),at=r.useCallback(async()=>{if(f)try{let e=Date.parse(x)/1e3,a=Date.parse(y)/1e3;const s=`/api/statistics/channel?start_timestamp=${e}&end_timestamp=${a}&default_time=${g}`,l=await W.get(s),{success:i,message:d,data:b}=l.data;i?(na(b||[]),Ra(b||[])):G(d)}catch(e){console.error("Error loading channel data:",e)}},[x,y,g,f]),st=r.useCallback(async()=>{if(f)try{let e=Date.parse(x)/1e3,a=Date.parse(y)/1e3;const s=`/api/statistics/token?start_timestamp=${e}&end_timestamp=${a}&default_time=${g}`,l=await W.get(s),{success:i,message:d,data:b}=l.data;i?(ia(b||[]),La(b||[])):G(d)}catch(e){console.error("Error loading token data:",e)}},[x,y,g,f]),ot=r.useCallback(async()=>{if(f)try{let e=Date.parse(x)/1e3,a=Date.parse(y)/1e3;const s=`/api/statistics/user?start_timestamp=${e}&end_timestamp=${a}&default_time=${g}`,l=await W.get(s),{success:i,message:d,data:b}=l.data;i?(ca(b||[]),Ha(b||[])):G(d)}catch(e){console.error("Error loading user data:",e)}},[x,y,g,f]),ue=r.useCallback(async()=>{f&&await Promise.all([at(),st(),ot()])},[at,st,ot,f]),J=r.useCallback(async()=>{et(!0);try{const e=await W.get("/api/uptime/status"),{success:a,message:s,data:l}=e.data;a?(fa(l||[]),l&&l.length>0&&!M&&tt(l[0].categoryName)):G(s)}catch(e){console.error(e)}finally{et(!1)}},[M]),Se=r.useCallback(async()=>{await Promise.all([ce(),J()]),await ue()},[ce,J,ue]),_a=r.useCallback(()=>{Se(),De(!1)},[Se]),Ba=r.useCallback(async()=>{await ce(),await J(),await ue()},[ce,J,ue]),Na=r.useCallback(()=>{De(!0)},[]),Ma=r.useCallback(()=>{De(!1)},[]),Aa=()=>{if(qe.current){const e=qe.current,a=e.scrollHeight>e.clientHeight,s=e.scrollTop+e.clientHeight>=e.scrollHeight-5;oa(a&&!s)}},X=(e,a)=>{if(e.current){const s=e.current,l=s.scrollHeight>s.clientHeight,i=s.scrollTop+s.clientHeight>=s.scrollHeight-5;a(l&&!i)}},de=(e,a)=>{X(e,a)};r.useEffect(()=>{const e=setTimeout(()=>{if(Aa(),X(ke,Ze),X(Fe,Ye),N.length===1)X(Te,ne);else if(N.length>1&&M){const a=re.current[M];a&&X(a,ne)}},100);return()=>clearTimeout(e)},[N,M]),r.useEffect(()=>{const e=setTimeout(()=>{zt(!0)},100);return()=>clearTimeout(e)},[]);const $a=async()=>{let e=await W.get("/api/user/self");const{success:a,message:s,data:l}=e.data;a?p({type:"login",payload:l}):G(s)},lt=r.useCallback(e=>{const a={totalQuota:0,totalTimes:0,totalTokens:0,uniqueModels:new Set,timePoints:[],timeQuotaMap:new Map,timeTokensMap:new Map,timeCountMap:new Map};return e.forEach(s=>{a.uniqueModels.add(s.model_name),a.totalTokens+=s.token_used,a.totalQuota+=s.quota,a.totalTimes+=s.count;const l=Ie(s.created_at,g);a.timePoints.includes(l)||a.timePoints.push(l),ze(l,a.timeQuotaMap,a.timeTokensMap,a.timeCountMap),P(a.timeQuotaMap,l,s.quota),P(a.timeTokensMap,l,s.token_used),P(a.timeCountMap,l,s.count)}),a.timePoints.sort(),a},[g,ze,P]),rt=r.useCallback((e,a,s,l)=>{const i=e.map(v=>a.get(v)||0),d=e.map(v=>s.get(v)||0),b=e.map(v=>l.get(v)||0),F=[],V=[];if(e.length>=2){const v=oe(g);for(let K=0;K<e.length;K++)F.push(l.get(e[K])/v),V.push(s.get(e[K])/v)}return{balance:[],usedQuota:[],requestCount:[],times:b,consumeQuota:i,tokens:d,rpm:F,tpm:V}},[g,oe]),nt=r.useCallback(e=>{const a={};return Array.from(e).forEach(s=>{a[s]=D[s]||Ge[s]||gs(s)}),a},[Ge]),it=r.useCallback(e=>{const a=new Map;return e.forEach(s=>{const l=Ie(s.created_at,g),i=s.model_name,d=`${l}-${i}`;a.has(d)||a.set(d,{time:l,model:i,quota:0,count:0});const b=a.get(d);b.quota+=s.quota,b.count+=s.count}),a},[g]),ct=r.useCallback((e,a)=>{let s=Array.from(new Set([...e.values()].map(l=>l.time)));if(s.length<7){const l=Math.max(...a.map(d=>d.created_at)),i=oe(g,!0);s=Array.from({length:7},(d,b)=>Ie(l-(6-b)*i,g))}return s},[g,oe]),Ia=r.useCallback(e=>{const a=lt(e),{totalQuota:s,totalTimes:l,totalTokens:i,uniqueModels:d,timePoints:b,timeQuotaMap:F,timeTokensMap:V,timeCountMap:v}=a,K=rt(b,F,V,v);ra(K);const ee=nt(d);aa(ee);const me=it(e),Be=new Map;for(let[C,m]of me)P(Be,m.model,m.count);const Ft=Array.from(Be).map(([C,m])=>({type:C,value:m})).sort((C,m)=>m.value-C.value),Tt=ct(me,e);let pe=[];Tt.forEach(C=>{let m=Array.from(d).map(T=>{const w=`${C}-${T}`,L=me.get(w);return{Time:C,Model:T,rawQuota:(L==null?void 0:L.quota)||0,Usage:L!=null&&L.quota?bs(L.quota,4):0}});const he=m.reduce((T,w)=>T+w.rawQuota,0);m.sort((T,w)=>w.rawQuota-T.rawQuota),m=m.map(T=>({...T,TimeSum:he})),pe.push(...m)}),pe.sort((C,m)=>C.Time.localeCompare(m.Time)),j(ya,Ft,`${o("总计")}：${E(l)}`,ee,"id0"),j(ja,pe,`${o("总计")}：${I(s,2)}`,ee,"barData");let Ne=[];Tt.forEach(C=>{const m=Array.from(d).map(he=>{const T=`${C}-${he}`,w=me.get(T);return{Time:C,Model:he,Count:(w==null?void 0:w.count)||0}});Ne.push(...m)}),Ne.sort((C,m)=>C.Time.localeCompare(m.Time));const Ua=Array.from(Be).map(([C,m])=>({Model:C,Count:m})).sort((C,m)=>m.Count-C.Count);j(ka,Ne,`${o("总计")}：${E(l)}`,ee,"lineData"),j(Ta,Ua,`${o("总计")}：${E(l)}`,ee,"rankData"),Xt(Ft),ta(pe),Gt(s),Yt(l),Zt(i)},[lt,rt,nt,it,ct,j,P,o]),Ra=r.useCallback(e=>{if(!e||e.length===0)return;const a={};e.forEach(l=>{const i=`${l.time}-${l.channel_name||"Channel "+l.channel_id}`;a[i]||(a[i]={Time:l.time,Channel:l.channel_name||"Channel "+l.channel_id,Count:0}),a[i].Count+=l.count});const s=Object.values(a);s.sort((l,i)=>l.Time.localeCompare(i.Time)),j(da,s,`${o("总计")}：${s.reduce((l,i)=>l+i.Count,0)}`,D,"channelData")},[j,o]),La=r.useCallback(e=>{if(!e||e.length===0)return;const a={};e.forEach(l=>{const i=`${l.time}-${l.token_name}`;a[i]||(a[i]={Time:l.time,Token:l.token_name,Count:0}),a[i].Count+=l.count});const s=Object.values(a);s.sort((l,i)=>l.Time.localeCompare(i.Time)),j(pa,s,`${o("总计")}：${s.reduce((l,i)=>l+i.Count,0)}`,D,"tokenData")},[j,o]),Ha=r.useCallback(e=>{if(!e||e.length===0)return;const a={};e.forEach(l=>{const i=`${l.time}-${l.username}`;a[i]||(a[i]={Time:l.time,User:l.username,Count:0}),a[i].Count+=l.count});const s=Object.values(a);s.sort((l,i)=>l.Time.localeCompare(i.Time)),j(ga,s,`${o("总计")}：${s.reduce((l,i)=>l+i.Count,0)}`,D,"userData")},[j,o]),Pa=r.useMemo(()=>[{color:"grey",label:o("默认"),type:"default"},{color:"blue",label:o("进行中"),type:"ongoing"},{color:"green",label:o("成功"),type:"success"},{color:"orange",label:o("警告"),type:"warning"},{color:"red",label:o("异常"),type:"error"}],[o]),Q=r.useMemo(()=>({1:{color:"#10b981",label:o("正常"),text:o("可用率")},0:{color:"#ef4444",label:o("异常"),text:o("有异常")},2:{color:"#f59e0b",label:o("高延迟"),text:o("高延迟")},3:{color:"#3b82f6",label:o("维护中"),text:o("维护中")}}),[o]),qa=r.useMemo(()=>Object.entries(Q).map(([e,a])=>({status:Number(e),color:a.color,label:a.label})),[Q]),_e=r.useCallback(e=>{var a;return((a=Q[e])==null?void 0:a.color)||"#8b9aa7"},[Q]),ut=r.useCallback(e=>{var a;return((a=Q[e])==null?void 0:a.text)||o("未知")},[Q,o]);r.useMemo(()=>{var e;return((e=n==null?void 0:n.status)==null?void 0:e.api_info)||[]},[(jt=n==null?void 0:n.status)==null?void 0:jt.api_info]);const dt=r.useMemo(()=>{var a;return(((a=n==null?void 0:n.status)==null?void 0:a.announcements)||[]).map(s=>({...s,time:Cs(s.publishDate)}))},[(Dt=n==null?void 0:n.status)==null?void 0:Dt.announcements]),mt=r.useMemo(()=>{var e;return((e=n==null?void 0:n.status)==null?void 0:e.faq)||[]},[(kt=n==null?void 0:n.status)==null?void 0:kt.faq]),pt=r.useCallback(e=>{if(!e||e.length===0)return t.jsx("div",{className:"flex justify-center items-center py-4",children:t.jsx(ge,{image:t.jsx(be,{style:_}),darkModeImage:t.jsx(Ce,{style:_}),title:o("暂无监控数据")})});const a={};e.forEach(l=>{const i=l.group||"";a[i]||(a[i]=[]),a[i].push(l)});const s=(l,i)=>t.jsxs("div",{className:"p-2 hover:bg-white rounded-lg transition-colors",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:_e(l.status)}}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:l.name})]}),t.jsxs("span",{className:"text-xs text-gray-500",children:[((l.uptime||0)*100).toFixed(2),"%"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs text-gray-500",children:ut(l.status)}),t.jsx("div",{className:"flex-1",children:t.jsx(ss,{percent:(l.uptime||0)*100,showInfo:!1,"aria-label":`${l.name} uptime`,stroke:_e(l.status)})})]})]},i);return Object.entries(a).map(([l,i])=>t.jsxs("div",{className:"mb-2",children:[l&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-md font-semibold text-gray-500 px-2 py-1",children:l}),t.jsx(Ga,{})]}),i.map(s)]},l||"default"))},[o,_e,ut]);return r.useEffect(()=>{$a(),Pe.current||(Is({isWatchingThemeSwitch:!0}),Pe.current=!0,Ba())},[]),t.jsxs("div",{className:"bg-gray-50 h-full mt-[64px] px-2",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-2xl font-semibold text-gray-800 transition-opacity duration-1000 ease-in-out",style:{opacity:Kt?1:0},children:Ea}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx(Me,{type:"tertiary",icon:t.jsx(Za,{}),onClick:Na,className:`bg-green-500 hover:bg-green-600 ${Ue}`}),t.jsx(Me,{type:"tertiary",icon:t.jsx(wt,{}),onClick:Se,loading:ve,className:`bg-blue-500 hover:bg-blue-600 ${Ue}`})]})]}),t.jsx(Ya,{title:o("搜索条件"),visible:la,onOk:_a,onCancel:Ma,closeOnEsc:!0,size:R?"full-width":"small",centered:!0,children:t.jsxs(te,{ref:H,layout:"vertical",className:"w-full",children:[le(te.DatePicker,{field:"start_timestamp",label:o("起始时间"),initValue:x,value:x,type:"dateTime",name:"start_timestamp",onChange:e=>ie(e,"start_timestamp")}),le(te.DatePicker,{field:"end_timestamp",label:o("结束时间"),initValue:y,value:y,type:"dateTime",name:"end_timestamp",onChange:e=>ie(e,"end_timestamp")}),le(te.Select,{field:"data_export_default_time",label:o("时间粒度"),initValue:g,placeholder:o("时间粒度"),name:"data_export_default_time",optionList:Ut,onChange:e=>ie(e,"data_export_default_time")}),f&&le(te.Input,{field:"username",label:o("用户名称"),value:Ee,placeholder:o("可选值"),name:"username",onChange:e=>ie(e,"username")})]})}),t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Sa.map((e,a)=>t.jsx(ae,{...Z,className:`${e.color} border-0 !rounded-2xl w-full`,title:e.title,style:{backgroundColor:e.bgColor},children:t.jsx("div",{className:"space-y-4",children:e.items.map((s,l)=>t.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:s.onClick,children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(Ja,{className:"mr-3",size:"small",color:s.avatarColor,children:s.icon}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-gray-500",children:s.title}),t.jsx("div",{className:"text-lg font-semibold",children:t.jsx(St,{loading:ve,active:!0,placeholder:t.jsx(St.Paragraph,{active:!0,rows:1,style:{width:"65px",height:"24px",marginTop:"4px"}}),children:s.value})})]})]}),(ve||s.trendData&&s.trendData.length>0)&&t.jsx("div",{className:"w-24 h-10",children:t.jsx($,{spec:wa(s.trendData,s.trendColor,s.trendBgColor),option:S})})]},l))})},a))})}),t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"grid grid-cols-1 gap-4 ",children:[t.jsx(ae,{...Z,className:"shadow-sm !rounded-2xl ",title:t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between w-full gap-3",children:[t.jsxs("div",{className:xe,children:[t.jsx(fs,{size:16}),o("模型数据分析")]}),t.jsxs(_t,{type:"button",activeKey:B,onChange:sa,children:[t.jsx(A,{tab:t.jsxs("span",{children:[t.jsx(z,{}),o("消耗分布")]}),itemKey:"1"}),t.jsx(A,{tab:t.jsxs("span",{children:[t.jsx(Et,{}),o("消耗趋势")]}),itemKey:"2"}),t.jsx(A,{tab:t.jsxs("span",{children:[t.jsx(Xa,{}),o("调用次数分布")]}),itemKey:"3"}),t.jsx(A,{tab:t.jsxs("span",{children:[t.jsx(z,{}),o("调用次数排行")]}),itemKey:"4"}),f&&t.jsx(A,{tab:t.jsxs("span",{children:[t.jsx(z,{}),o("按渠道统计")]}),itemKey:"5"}),f&&t.jsx(A,{tab:t.jsxs("span",{children:[t.jsx(z,{}),o("按令牌统计")]}),itemKey:"6"}),f&&t.jsx(A,{tab:t.jsxs("span",{children:[t.jsx(z,{}),o("按用户统计")]}),itemKey:"7"})]})]}),bodyStyle:{padding:0},children:t.jsxs("div",{className:"h-96 p-2",children:[B==="1"&&t.jsx($,{spec:va,option:S}),B==="2"&&t.jsx($,{spec:Da,option:S}),B==="3"&&t.jsx($,{spec:xa,option:S}),B==="4"&&t.jsx($,{spec:Fa,option:S}),B==="5"&&f&&t.jsx($,{spec:ua,option:S}),B==="6"&&f&&t.jsx($,{spec:ma,option:S}),B==="7"&&f&&t.jsx($,{spec:ha,option:S})]})}),Ht]})}),Pt&&t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[Qe&&t.jsx(ae,{...Z,className:"shadow-sm !rounded-2xl lg:col-span-2",title:t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-2 w-full",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(xs,{size:16}),o("系统公告"),t.jsx(Bt,{color:"white",shape:"circle",children:o("显示最新20条")})]}),t.jsx("div",{className:"flex flex-wrap gap-3 text-xs",children:Pa.map((e,a)=>t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color==="grey"?"#8b9aa7":e.color==="blue"?"#3b82f6":e.color==="green"?"#10b981":e.color==="orange"?"#f59e0b":e.color==="red"?"#ef4444":"#8b9aa7"}}),t.jsx("span",{className:"text-gray-600",children:e.label})]},a))})]}),bodyStyle:{padding:0},children:t.jsxs("div",{className:"card-content-container",children:[t.jsx("div",{ref:ke,className:"p-2 max-h-96 overflow-y-auto card-content-scroll",onScroll:()=>de(ke,Ze),children:dt.length>0?t.jsx(Nt,{mode:"alternate",children:dt.map((e,a)=>t.jsx(Nt.Item,{type:e.type||"default",time:e.time,children:t.jsxs("div",{children:[t.jsx("div",{dangerouslySetInnerHTML:{__html:Ae.parse(e.content||"")}}),e.extra&&t.jsx("div",{className:"text-xs text-gray-500",dangerouslySetInnerHTML:{__html:Ae.parse(e.extra)}})]})},a))}):t.jsx("div",{className:"flex justify-center items-center py-8",children:t.jsx(ge,{image:t.jsx(be,{style:_}),darkModeImage:t.jsx(Ce,{style:_}),title:o("暂无系统公告"),description:o("请联系管理员在系统设置中配置公告信息")})})}),t.jsx("div",{className:"card-content-fade-indicator",style:{opacity:ba?1:0}})]})}),Ve&&t.jsx(ae,{...Z,className:"shadow-sm !rounded-2xl lg:col-span-1",title:t.jsxs("div",{className:xe,children:[t.jsx(ys,{size:16}),o("常见问答")]}),bodyStyle:{padding:0},children:t.jsxs("div",{className:"card-content-container",children:[t.jsx("div",{ref:Fe,className:"p-2 max-h-96 overflow-y-auto card-content-scroll",onScroll:()=>de(Fe,Ye),children:mt.length>0?t.jsx(Mt,{accordion:!0,expandIcon:t.jsx(es,{}),collapseIcon:t.jsx(ts,{}),children:mt.map((e,a)=>t.jsx(Mt.Panel,{header:e.question,itemKey:a.toString(),children:t.jsx("div",{dangerouslySetInnerHTML:{__html:Ae.parse(e.answer||"")}})},a))}):t.jsx("div",{className:"flex justify-center items-center py-8",children:t.jsx(ge,{image:t.jsx(be,{style:_}),darkModeImage:t.jsx(Ce,{style:_}),title:o("暂无常见问答"),description:o("请联系管理员在系统设置中配置常见问答")})})}),t.jsx("div",{className:"card-content-fade-indicator",style:{opacity:Ca?1:0}})]})}),Ke&&t.jsxs(ae,{...Z,className:"shadow-sm !rounded-2xl lg:col-span-1",title:t.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx($e,{size:16}),o("服务可用性")]}),t.jsx(Me,{icon:t.jsx(wt,{}),onClick:J,loading:Xe,size:"small",theme:"borderless",type:"tertiary",className:"text-gray-500 hover:text-blue-500 hover:bg-blue-50 !rounded-full"})]}),bodyStyle:{padding:0},children:[t.jsx("div",{className:"relative",children:t.jsx(as,{spinning:Xe,children:N.length>0?N.length===1?t.jsxs("div",{className:"card-content-container",children:[t.jsx("div",{ref:Te,className:"p-2 max-h-[24rem] overflow-y-auto card-content-scroll",onScroll:()=>de(Te,ne),children:pt(N[0].monitors)}),t.jsx("div",{className:"card-content-fade-indicator",style:{opacity:Je?1:0}})]}):t.jsx(_t,{type:"card",collapsible:!0,activeKey:M,onChange:tt,size:"small",children:N.map((e,a)=>{re.current[e.categoryName]||(re.current[e.categoryName]=ls.createRef());const s=re.current[e.categoryName];return t.jsx(A,{tab:t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx($e,{size:14}),e.categoryName,t.jsx(Bt,{color:M===e.categoryName?"red":"grey",size:"small",shape:"circle",children:e.monitors?e.monitors.length:0})]}),itemKey:e.categoryName,children:t.jsxs("div",{className:"card-content-container",children:[t.jsx("div",{ref:s,className:"p-2 max-h-[21.5rem] overflow-y-auto card-content-scroll",onScroll:()=>de(s,ne),children:pt(e.monitors)}),t.jsx("div",{className:"card-content-fade-indicator",style:{opacity:M===e.categoryName&&Je?1:0}})]})},a)})}):t.jsx("div",{className:"flex justify-center items-center py-8",children:t.jsx(ge,{image:t.jsx(be,{style:_}),darkModeImage:t.jsx(Ce,{style:_}),title:o("暂无监控数据"),description:o("请联系管理员在系统设置中配置Uptime")})})})}),N.length>0&&t.jsx("div",{className:"p-3 bg-gray-50 rounded-b-2xl",children:t.jsx("div",{className:"flex flex-wrap gap-3 text-xs justify-center",children:qa.map((e,a)=>t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),t.jsx("span",{className:"text-gray-600",children:e.label})]},a))})})]})]})})]})};export{Js as default};
